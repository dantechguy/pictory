<!DOCTYPE html>
<html>
<head>
  <title>pictory</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <input id='name' type='text' placeholder='name' maxlength='8'>
  <input id='id' type='text' placeholder='room id' maxlength='4'>
  <button id='submit' onclick='checkNameAndRoomId()'>submit</button>
  <button id='rejoin' onclick='reJoinRoom()'>re join</button>

  <script type="text/javascript" src="values.js"></script>
  <script type="text/javascript" src="rest.js"></script>
  <script type="text/javascript" src="cookie.js"></script>
  <script type="text/javascript" src="error.js"></script>
  <script type="text/javascript" src="nameAndRoomIdValidation.js"></script>
  <script type="text/javascript" src="goToUrl.js"></script>

  <script type='text/javascript'>

// doms
var nameInputDom = document.querySelector('#name');
var roomIdInputDom = document.querySelector('#id');
var reJoinInputDom = document.querySelector('#rejoin');

// re-join code
function reJoinRoom() {
  goToUrl(values.url.GAME);
}

if (getCookie(values.cookie.SESSION_ID_KEY) == '') {
  reJoinInputDom.style.display = 'none';
}

// submit button call
function checkNameAndRoomId() {
  let data = {
    name: nameInputDom.value,
    roomId: roomIdInputDom.value
  };
  if (nameAndRoomIdAreValid(data)) {
    sendPostJoinRequest(data);
  } else {
    showError(whatIsWrongWithNameAndRoomId(data));
  };
}

// sending and processing join request
function sendPostJoinRequest(data) {
  let requestJsonBody = generatePostJoinRequestJsonBody(data);
  postData(values.url.JOIN, requestJsonBody)
  .then(nameAndRoomIdSuccess)
  .catch(showError);
}

function generatePostJoinRequestJsonBody(data) {
  let name = data.name;
  let roomId = data.roomId;
  let requestJsonBody = {
    name: name,
    roomId: roomId
  };
  return requestJsonBody;
}

function nameAndRoomIdSuccess(responseJson) {
  sessionId = responseJson.data
  setSessionIdCookie(sessionId);
  goToUrl(values.url.GAME);
}

// global functions



  </script>
</body>
</html>
